version: 2

models:
  - name: ds_cleverbox__parsed__service_sales
    description: "CleverBox Parsed Service Sales"
    config:
      alias: parsed__service_sales
      meta:
        tf_config:
          filter: name IS NOT NULL
                  AND code IS NOT NULL
                  AND date IS NOT NULL
                  AND branch IS NOT NULL
                  AND value IS NOT NULL
                  AND client_code IS NOT NULL
                  AND client_name IS NOT NULL
                  AND expert_name IS NOT NULL
    columns:
      - name: name
        data_type: STRING
        description: Service name
        data_tests:
          - not_null:
              config:
                severity: warn
      - name: code
        data_type: STRING
        logic_type: STRING.CODE
        description: Service code
        data_tests:
          - not_null:
              config:
                severity: warn
          - relationships:
              to: ref('ds_cleverbox__parsed__services')
              field: code
      - name: date
        data_type: DATE
        description: Service date of sale
        data_tests:
          - not_null:
              config:
                severity: warn
      - name: branch
        data_type: STRING
        description: Branch of service sale
        data_tests:
          - not_null:
              config:
                severity: warn
      - name: value
        data_type: NUMERIC.COST
        description: Cost of service
        data_tests:
          - not_null:
              config:
                severity: warn
      - name: paid
        data_type: NUMERIC.COST
        description: Client payed money
        meta:
          tf_config:
            expression: COALESCE(paid, 0)
      - name: discount
        data_type: NUMERIC.COST
        description: Services discount
        meta:
          tf_config:
            expression: COALESCE(discount, 0)
      - name: subscription
        data_type: NUMERIC.COST
        description: Subscription
        meta:
          tf_config:
            expression: COALESCE(subscription, 0)
      - name: client_code
        data_type: STRING
        logic_type: STRING.CODE
        description: Client code
        data_tests:
          - not_null:
              config:
                severity: warn
      - name: client_name
        data_type: STRING
        description: Client name
        data_tests:
          - not_null:
              config:
                severity: warn
      - name: expert_name
        data_type: STRING
        description: The employee who sold the service
        data_tests:
          - not_null:
              config:
                severity: warn
      - name: cost_price
        data_type: NUMERIC.COST
        description: Cost price of service
        meta:
          tf_config:
            expression: COALESCE(cost_price, 0)
      - name: category
        data_type: STRING
        description: Service category
      - name: direction
        data_type: STRING
        description: Service direction
