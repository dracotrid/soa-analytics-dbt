version: 2

models:
  - name: ds_cleverbox__parsed__services
    description: "CleverBox Parsed Services"
    config:
      alias: parsed__services
      meta:
        tf_config:
          filter: guid IS NOT NULL
                  AND name IS NOT NULL
                  AND direction IS NOT NULL
                  AND category IS NOT NULL
    columns:
      - name: guid
        data_type: STRING
        description: Record identifier
        meta:
          tf_config:
            macro: cmf__normalise__pad_left_signs
            params: [guid, 6, '0']
        data_tests:
          - not_null:
              config:
                severity: warn
      - name: code
        data_type: STRING.CODE
        description: Record identifier
        meta:
          tf_config:
            macro: cmf__normalise__pad_left_signs
            params: [CAST(suid AS STRING), 6, '0']
      - name: name
        data_type: STRING
        description: Service name
        data_tests:
          - not_null:
              config:
                severity: warn
      - name: direction
        data_type: STRING
        description: Service direction
        data_tests:
          - not_null:
              config:
                severity: warn
      - name: category
        data_type: STRING
        description: Service category
        data_tests:
          - not_null:
              config:
                severity: warn
      - name: value
        data_type: NUMERIC.COST
        description: Price of service
        meta:
          tf_config:
            expression: COALESCE(value, 0)
      - name: cost_price
        data_type: NUMERIC.COST
        description: Cost price of service
        meta:
          tf_config:
            expression: COALESCE(cost_price, 0)
